[root@piaoliuping ~]# iptables -S
-P INPUT ACCEPT
-P FORWARD DROP
-P OUTPUT ACCEPT
-N DOCKER
-N DOCKER-ISOLATION-STAGE-1
-N DOCKER-ISOLATION-STAGE-2
-N DOCKER-USER
-A FORWARD -j DOCKER-USER
-A FORWARD -j DOCKER-ISOLATION-STAGE-1
-A FORWARD -o br-d020810d8445 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A FORWARD -o br-d020810d8445 -j DOCKER
-A FORWARD -i br-d020810d8445 ! -o br-d020810d8445 -j ACCEPT
-A FORWARD -i br-d020810d8445 -o br-d020810d8445 -j ACCEPT
-A FORWARD -o br-647981b1f3d9 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A FORWARD -o br-647981b1f3d9 -j DOCKER
-A FORWARD -i br-647981b1f3d9 ! -o br-647981b1f3d9 -j ACCEPT
-A FORWARD -i br-647981b1f3d9 -o br-647981b1f3d9 -j ACCEPT
-A FORWARD -o br-3864457186c2 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A FORWARD -o br-3864457186c2 -j DOCKER
-A FORWARD -i br-3864457186c2 ! -o br-3864457186c2 -j ACCEPT
-A FORWARD -i br-3864457186c2 -o br-3864457186c2 -j ACCEPT
-A FORWARD -o docker0 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A FORWARD -o docker0 -j DOCKER
-A FORWARD -i docker0 ! -o docker0 -j ACCEPT
-A FORWARD -i docker0 -o docker0 -j ACCEPT
-A FORWARD -o br-2edfb8761119 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A FORWARD -o br-2edfb8761119 -j DOCKER
-A FORWARD -i br-2edfb8761119 ! -o br-2edfb8761119 -j ACCEPT
-A FORWARD -i br-2edfb8761119 -o br-2edfb8761119 -j ACCEPT
-A DOCKER -d 192.168.0.2/32 ! -i br-3864457186c2 -o br-3864457186c2 -p tcp -m tcp --dport 3306 -j ACCEPT
-A DOCKER -d 192.168.32.2/32 ! -i br-647981b1f3d9 -o br-647981b1f3d9 -p tcp -m tcp --dport 6379 -j ACCEPT
-A DOCKER -d 192.168.32.4/32 ! -i br-647981b1f3d9 -o br-647981b1f3d9 -p tcp -m tcp --dport 80 -j ACCEPT
-A DOCKER -d 192.168.32.6/32 ! -i br-647981b1f3d9 -o br-647981b1f3d9 -p tcp -m tcp --dport 9001 -j ACCEPT
-A DOCKER-ISOLATION-STAGE-1 -i br-d020810d8445 ! -o br-d020810d8445 -j DOCKER-ISOLATION-STAGE-2
-A DOCKER-ISOLATION-STAGE-1 -i br-647981b1f3d9 ! -o br-647981b1f3d9 -j DOCKER-ISOLATION-STAGE-2
-A DOCKER-ISOLATION-STAGE-1 -i br-3864457186c2 ! -o br-3864457186c2 -j DOCKER-ISOLATION-STAGE-2
-A DOCKER-ISOLATION-STAGE-1 -i docker0 ! -o docker0 -j DOCKER-ISOLATION-STAGE-2
-A DOCKER-ISOLATION-STAGE-1 -i br-2edfb8761119 ! -o br-2edfb8761119 -j DOCKER-ISOLATION-STAGE-2
-A DOCKER-ISOLATION-STAGE-1 -j RETURN
-A DOCKER-ISOLATION-STAGE-2 -o br-d020810d8445 -j DROP
-A DOCKER-ISOLATION-STAGE-2 -o br-647981b1f3d9 -j DROP
-A DOCKER-ISOLATION-STAGE-2 -o br-3864457186c2 -j DROP
-A DOCKER-ISOLATION-STAGE-2 -o docker0 -j DROP
-A DOCKER-ISOLATION-STAGE-2 -o br-2edfb8761119 -j DROP
-A DOCKER-ISOLATION-STAGE-2 -j RETURN
-A DOCKER-USER -j RETURN
[root@piaoliuping ~]# iptables -S -t nat
-P PREROUTING ACCEPT
-P INPUT ACCEPT
-P OUTPUT ACCEPT
-P POSTROUTING ACCEPT
-N DOCKER
-A PREROUTING -m addrtype --dst-type LOCAL -j DOCKER
-A OUTPUT ! -d 127.0.0.0/8 -m addrtype --dst-type LOCAL -j DOCKER
-A POSTROUTING -s 192.168.128.0/20 ! -o br-d020810d8445 -j MASQUERADE
-A POSTROUTING -s 192.168.32.0/20 ! -o br-647981b1f3d9 -j MASQUERADE
-A POSTROUTING -s 192.168.0.0/20 ! -o br-3864457186c2 -j MASQUERADE
-A POSTROUTING -s 172.17.0.0/16 ! -o docker0 -j MASQUERADE
-A POSTROUTING -s 172.21.0.0/16 ! -o br-2edfb8761119 -j MASQUERADE
-A POSTROUTING -s 192.168.0.2/32 -d 192.168.0.2/32 -p tcp -m tcp --dport 3306 -j MASQUERADE
-A POSTROUTING -s 192.168.32.2/32 -d 192.168.32.2/32 -p tcp -m tcp --dport 6379 -j MASQUERADE
-A POSTROUTING -s 192.168.32.4/32 -d 192.168.32.4/32 -p tcp -m tcp --dport 80 -j MASQUERADE
-A POSTROUTING -s 192.168.32.6/32 -d 192.168.32.6/32 -p tcp -m tcp --dport 9001 -j MASQUERADE
-A DOCKER -i br-d020810d8445 -j RETURN
-A DOCKER -i br-647981b1f3d9 -j RETURN
-A DOCKER -i br-3864457186c2 -j RETURN
-A DOCKER -i docker0 -j RETURN
-A DOCKER -i br-2edfb8761119 -j RETURN
-A DOCKER -d 192.168.56.44/32 ! -i br-3864457186c2 -p tcp -m tcp --dport 3379 -j DNAT --to-destination 192.168.0.2:3306
-A DOCKER -d 192.168.56.44/32 ! -i br-647981b1f3d9 -p tcp -m tcp --dport 6380 -j DNAT --to-destination 192.168.32.2:6379
-A DOCKER -d 192.168.56.44/32 ! -i br-647981b1f3d9 -p tcp -m tcp --dport 31000 -j DNAT --to-destination 192.168.32.4:80
-A DOCKER -d 192.168.56.44/32 ! -i br-647981b1f3d9 -p tcp -m tcp --dport 9001 -j DNAT --to-destination 192.168.32.6:9001


[root@sixrooms-122-70-146-244 ~]# iptables -S
-P INPUT ACCEPT
-P FORWARD ACCEPT
-P OUTPUT ACCEPT
-N DOCKER
-N DOCKER-ISOLATION-STAGE-1
-N DOCKER-ISOLATION-STAGE-2
-N DOCKER-USER
-A INPUT -p tcp -m tcp --dport 32000 -j ACCEPT
-A INPUT -s 192.168.56.0/24 -j ACCEPT
-A INPUT -s 122.70.146.0/24 -j ACCEPT
-A INPUT -p tcp -m tcp --dport 31000 -j ACCEPT
-A INPUT -p tcp -m tcp --dport 7710 -j ACCEPT
-A INPUT -s 172.16.0.0/12 -j ACCEPT
-A INPUT -s 192.168.0.0/16 -j ACCEPT
-A INPUT -s 61.237.235.0/27 -j ACCEPT
-A INPUT -s 122.70.135.0/25 -j ACCEPT
-A INPUT -s 122.70.137.192/26 -j ACCEPT
-A INPUT -s 122.70.141.0/24 -j ACCEPT
-A INPUT -s 222.35.74.0/23 -j ACCEPT
-A INPUT -s 218.205.214.128/25 -j ACCEPT
-A INPUT -s 221.179.202.0/24 -j ACCEPT
-A INPUT -s 221.179.203.0/25 -j ACCEPT
-A INPUT -s 125.208.4.0/24 -j ACCEPT
-A INPUT -p udp -m udp --sport 53 -j ACCEPT
-A INPUT -p udp -m udp --sport 123 -j ACCEPT
-A INPUT -p udp -m multiport --ports 4257 -j ACCEPT
-A INPUT -s 172.16.0.0/12 -p tcp -j ACCEPT
-A INPUT -s 172.16.0.0/12 -p udp -j ACCEPT
-A INPUT -i lo -j ACCEPT
-A INPUT -p tcp -m tcp --tcp-flags FIN,SYN,RST,ACK SYN -j DROP
-A INPUT -p udp -j DROP
-A FORWARD -j DOCKER-USER
-A FORWARD -j DOCKER-ISOLATION-STAGE-1
-A FORWARD -o br-07fc551b905d -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A FORWARD -o br-07fc551b905d -j DOCKER
-A FORWARD -i br-07fc551b905d ! -o br-07fc551b905d -j ACCEPT
-A FORWARD -i br-07fc551b905d -o br-07fc551b905d -j ACCEPT
-A FORWARD -o br-33c9d652bf21 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A FORWARD -o br-33c9d652bf21 -j DOCKER
-A FORWARD -i br-33c9d652bf21 ! -o br-33c9d652bf21 -j ACCEPT
-A FORWARD -i br-33c9d652bf21 -o br-33c9d652bf21 -j ACCEPT
-A FORWARD -o docker0 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A FORWARD -o docker0 -j DOCKER
-A FORWARD -i docker0 ! -o docker0 -j ACCEPT
-A FORWARD -i docker0 -o docker0 -j ACCEPT
-A DOCKER -d 172.19.0.2/32 ! -i br-33c9d652bf21 -o br-33c9d652bf21 -p tcp -m tcp --dport 9001 -j ACCEPT
-A DOCKER -d 172.19.0.3/32 ! -i br-33c9d652bf21 -o br-33c9d652bf21 -p tcp -m tcp --dport 6379 -j ACCEPT
-A DOCKER -d 172.19.0.5/32 ! -i br-33c9d652bf21 -o br-33c9d652bf21 -p tcp -m tcp --dport 80 -j ACCEPT
-A DOCKER -d 172.20.0.4/32 ! -i br-07fc551b905d -o br-07fc551b905d -p tcp -m tcp --dport 80 -j ACCEPT
-A DOCKER -d 172.20.0.5/32 ! -i br-07fc551b905d -o br-07fc551b905d -p tcp -m tcp --dport 6379 -j ACCEPT
-A DOCKER-ISOLATION-STAGE-1 -i br-07fc551b905d ! -o br-07fc551b905d -j DOCKER-ISOLATION-STAGE-2
-A DOCKER-ISOLATION-STAGE-1 -i br-33c9d652bf21 ! -o br-33c9d652bf21 -j DOCKER-ISOLATION-STAGE-2
-A DOCKER-ISOLATION-STAGE-1 -i docker0 ! -o docker0 -j DOCKER-ISOLATION-STAGE-2
-A DOCKER-ISOLATION-STAGE-1 -j RETURN
-A DOCKER-ISOLATION-STAGE-2 -o br-07fc551b905d -j DROP
-A DOCKER-ISOLATION-STAGE-2 -o br-33c9d652bf21 -j DROP
-A DOCKER-ISOLATION-STAGE-2 -o docker0 -j DROP
-A DOCKER-ISOLATION-STAGE-2 -j RETURN
-A DOCKER-USER -j RETURN
[root@sixrooms-122-70-146-244 ~]# iptables -S -t nat
-P PREROUTING ACCEPT
-P INPUT ACCEPT
-P OUTPUT ACCEPT
-P POSTROUTING ACCEPT
-N DOCKER
-A PREROUTING -m addrtype --dst-type LOCAL -j DOCKER
-A OUTPUT ! -d 127.0.0.0/8 -m addrtype --dst-type LOCAL -j DOCKER
-A POSTROUTING -s 172.20.0.0/16 ! -o br-07fc551b905d -j MASQUERADE
-A POSTROUTING -s 172.19.0.0/16 ! -o br-33c9d652bf21 -j MASQUERADE
-A POSTROUTING -s 172.17.0.0/16 ! -o docker0 -j MASQUERADE
-A POSTROUTING -s 172.19.0.2/32 -d 172.19.0.2/32 -p tcp -m tcp --dport 9001 -j MASQUERADE
-A POSTROUTING -s 172.19.0.3/32 -d 172.19.0.3/32 -p tcp -m tcp --dport 6379 -j MASQUERADE
-A POSTROUTING -s 172.19.0.5/32 -d 172.19.0.5/32 -p tcp -m tcp --dport 80 -j MASQUERADE
-A POSTROUTING -s 172.20.0.4/32 -d 172.20.0.4/32 -p tcp -m tcp --dport 80 -j MASQUERADE
-A POSTROUTING -s 172.20.0.5/32 -d 172.20.0.5/32 -p tcp -m tcp --dport 6379 -j MASQUERADE
-A DOCKER -i br-07fc551b905d -j RETURN
-A DOCKER -i br-33c9d652bf21 -j RETURN
-A DOCKER -i docker0 -j RETURN
-A DOCKER -d 192.168.56.245/32 ! -i br-33c9d652bf21 -p tcp -m tcp --dport 9001 -j DNAT --to-destination 172.19.0.2:9001
-A DOCKER -d 192.168.56.245/32 ! -i br-33c9d652bf21 -p tcp -m tcp --dport 6380 -j DNAT --to-destination 172.19.0.3:6379
-A DOCKER -d 192.168.56.245/32 ! -i br-33c9d652bf21 -p tcp -m tcp --dport 31000 -j DNAT --to-destination 172.19.0.5:80
-A DOCKER -d 192.168.56.245/32 ! -i br-07fc551b905d -p tcp -m tcp --dport 32000 -j DNAT --to-destination 172.20.0.4:80
-A DOCKER -d 192.168.56.245/32 ! -i br-07fc551b905d -p tcp -m tcp --dport 32002 -j DNAT --to-destination 172.20.0.5:6379